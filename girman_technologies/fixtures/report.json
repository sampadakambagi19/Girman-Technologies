[
 {
  "add_total_row": 0,
  "columns": [
   {
    "fieldname": "employee",
    "fieldtype": "Link",
    "label": "Employee",
    "options": "Employee",
    "width": 0
   },
   {
    "fieldname": "employee_name",
    "fieldtype": "Data",
    "label": "Employee Name",
    "options": null,
    "width": 0
   },
   {
    "fieldname": "old_tax",
    "fieldtype": "Currency",
    "label": "Old Regime Deduction",
    "options": null,
    "width": 0
   },
   {
    "fieldname": "new_tax",
    "fieldtype": "Currency",
    "label": "New Regime Deduction",
    "options": null,
    "width": 0
   },
   {
    "fieldname": "preferred",
    "fieldtype": "Data",
    "label": "Preferred Regime",
    "options": null,
    "width": 0
   },
   {
    "fieldname": "better",
    "fieldtype": "Data",
    "label": "Better Option",
    "options": null,
    "width": 0
   },
   {
    "fieldname": "diff",
    "fieldtype": "Currency",
    "label": "Difference",
    "options": null,
    "width": 0
   }
  ],
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Report",
  "filters": [],
  "is_standard": "No",
  "javascript": null,
  "json": null,
  "letter_head": "Girman Technologies",
  "modified": "2025-09-04 15:14:54.027458",
  "module": "Payroll",
  "name": "Tax Regime comparision",
  "prepared_report": 1,
  "query": "SELECT\r\n    e.name AS employee,\r\n    e.employee_name AS \"Employee Name\",\r\n    COALESCE(old_sl.total_deduction, 0) AS \"Old Regime Deduction\",\r\n    COALESCE(new_sl.total_deduction, 0) AS \"New Regime Deduction\",\r\n    e.custom_tax_regime_preference AS \"Preferred Regime\",\r\n    CASE\r\n        WHEN COALESCE(old_sl.total_deduction, 0) < COALESCE(new_sl.total_deduction, 0) THEN 'Old Regime'\r\n        ELSE 'New Regime'\r\n    END AS \"Better Option\",\r\n    ABS(COALESCE(old_sl.total_deduction, 0) - COALESCE(new_sl.total_deduction, 0)) AS \"Difference\"\r\nFROM\r\n    `tabEmployee` e\r\nLEFT JOIN (\r\n    SELECT employee, total_deduction\r\n    FROM `tabSalary Slip`\r\n    WHERE salary_structure = 'Old Regime' AND docstatus = 1\r\n) AS old_sl ON old_sl.employee = e.name\r\nLEFT JOIN (\r\n    SELECT employee, total_deduction\r\n    FROM `tabSalary Slip`\r\n    WHERE salary_structure = 'New Regime' AND docstatus = 1\r\n) AS new_sl ON new_sl.employee = e.name\r\nORDER BY e.employee_name;\r\n",
  "ref_doctype": "Salary Slip",
  "reference_report": null,
  "report_name": "Tax Regime comparision",
  "report_script": "\r\ndef execute(filters=None):\r\n    columns = [\r\n        {\"label\": \"Employee\", \"fieldname\": \"employee\", \"fieldtype\": \"Link\", \"options\": \"Employee\", \"width\": 150},\r\n        {\"label\": \"Employee Name\", \"fieldname\": \"employee_name\", \"fieldtype\": \"Data\", \"width\": 180},\r\n        {\"label\": \"Old Regime Deduction\", \"fieldname\": \"old_tax\", \"fieldtype\": \"Currency\", \"width\": 180},\r\n        {\"label\": \"New Regime Deduction\", \"fieldname\": \"new_tax\", \"fieldtype\": \"Currency\", \"width\": 180},\r\n        {\"label\": \"Preferred Regime\", \"fieldname\": \"preferred\", \"fieldtype\": \"Data\", \"width\": 150},\r\n        {\"label\": \"Better Option\", \"fieldname\": \"better\", \"fieldtype\": \"Data\", \"width\": 150},\r\n        {\"label\": \"Difference\", \"fieldname\": \"diff\", \"fieldtype\": \"Currency\", \"width\": 150},\r\n    ]\r\n\r\n    data = []\r\n\r\n    employees = frappe.get_all(\"Employee\", fields=[\"name\", \"employee_name\", \"custom_tax_regime_preference\"])\r\n\r\n    for emp in employees:\r\n        # Force float values to avoid str vs bytes errors\r\n        old_tax = flt(frappe.db.get_value(\r\n            \"Salary Slip\",\r\n            {\"employee\": emp.name, \"salary_structure\": \"Old Regime\", \"docstatus\": 1},\r\n            \"total_deduction\"\r\n        ) or 0)\r\n\r\n        new_tax = flt(frappe.db.get_value(\r\n            \"Salary Slip\",\r\n            {\"employee\": emp.name, \"salary_structure\": \"New Regime\", \"docstatus\": 1},\r\n            \"total_deduction\"\r\n        ) or 0)\r\n\r\n        better = \"Old Regime\" if old_tax < new_tax else \"New Regime\"\r\n        diff = abs(old_tax - new_tax)\r\n\r\n        data.append({\r\n            \"employee\": emp.name,\r\n            \"employee_name\": emp.employee_name,\r\n            \"old_tax\": old_tax,\r\n            \"new_tax\": new_tax,\r\n            \"preferred\": emp.custom_tax_regime_preference,\r\n            \"better\": better,\r\n            \"diff\": diff\r\n        })\r\n\r\n    return columns, data\r\n",
  "report_type": "Query Report",
  "roles": [
   {
    "role": "HR Manager"
   },
   {
    "role": "HR User"
   },
   {
    "role": "Employee"
   },
   {
    "role": "Employee Self Service"
   }
  ],
  "timeout": 0
 }
]